# Firebase Cloud Messaging

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Firebase Cloud Messaging –≤ –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π Engagement –Ω–∞ Android-—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö

–ß—Ç–æ–±—ã –∏–º–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å [push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è](https://documentation.bloomreach.com/engagement/docs/android-sdk-push-notifications) —Å –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã Engagement –∏ –ø–æ–ª—É—á–∞—Ç—å –∏—Ö –≤ –≤–∞—à–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –Ω–∞ Android-—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–æ–µ–∫—Ç Firebase, —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Firebase messaging –≤ –≤–∞—à–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é Firebase Cloud Messaging –≤ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ Engagement.

> üëç
>
> SDK –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é —Å–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π, —á—Ç–æ–±—ã –ø–æ–º–æ—á—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º —É—Å–ø–µ—à–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è. –°–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è –æ—Ç—Å–ª–µ–¥–∏—Ç—å push-—Ç–æ–∫–µ–Ω, –∑–∞–ø—Ä–æ—Å–∏—Ç—å —É backend'–∞ Engagement –æ—Ç–ø—Ä–∞–≤–∫—É –±–µ–∑–∑–≤—É—á–Ω–æ–≥–æ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –≥–æ—Ç–æ–≤–æ –ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.
>
> –ß—Ç–æ–±—ã –≤–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `Sendsay.checkPushSetup = true` –ø–µ—Ä–µ–¥ [–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π SDK](https://documentation.bloomreach.com/engagement/docs/android-sdk-setup#initialize-the-sdk).
>
> –ú—ã –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –≤–∫–ª—é—á–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é —Å–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏–ª–∏ –µ—Å–ª–∏ –≤–∞–º –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Å—Ç–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É.

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Firebase

–°–Ω–∞—á–∞–ª–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–æ–µ–∫—Ç Firebase. –î–ª—è –ø–æ—à–∞–≥–æ–≤—ã—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —Ä–∞–∑–¥–µ–ª—É [–î–æ–±–∞–≤–ª–µ–Ω–∏–µ Firebase –≤ –≤–∞—à Android-–ø—Ä–æ–µ–∫—Ç](https://firebase.google.com/docs/android/setup#console) –≤ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Firebase.

–í–∫—Ä–∞—Ç—Ü–µ, –≤—ã —Å–æ–∑–¥–∞–¥–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç —Å –ø–æ–º–æ—â—å—é –∫–æ–Ω—Å–æ–ª–∏ Firebase, —Å–∫–∞—á–∞–µ—Ç–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ `google-services.json` –∏ –¥–æ–±–∞–≤–∏—Ç–µ –µ–≥–æ –≤ —Å–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –∞ —Ç–∞–∫–∂–µ –æ–±–Ω–æ–≤–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç—ã —Å–±–æ—Ä–∫–∏ Gradle –≤ –≤–∞—à–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏.

#### –ß–µ–∫-–ª–∏—Å—Ç:
- [ ] –§–∞–π–ª `google-services.json`, —Å–∫–∞—á–∞–Ω–Ω—ã–π –∏–∑ –∫–æ–Ω—Å–æ–ª–∏ Firebase, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø–∞–ø–∫–µ –≤–∞—à–µ–≥–æ **–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**, –Ω–∞–ø—Ä–∏–º–µ—Ä, *my-project/app/google-services.json*.
- [ ] –§–∞–π–ª —Å–±–æ—Ä–∫–∏ Gradle –≤–∞—à–µ–≥–æ **–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è** (–Ω–∞–ø—Ä–∏–º–µ—Ä, *my-project/app/build.gradle*) —Å–æ–¥–µ—Ä–∂–∏—Ç `apply plugin: 'com.google.gms.google-services'`.
- [ ] –í–∞—à **–≤–µ—Ä—Ö–Ω–µ–≥–æ —É—Ä–æ–≤–Ω—è** —Ñ–∞–π–ª —Å–±–æ—Ä–∫–∏ Gradle (–Ω–∞–ø—Ä–∏–º–µ—Ä, *my-project/build.gradle*) –∏–º–µ–µ—Ç `classpath 'com.google.gms:google-services:X.X.X'` –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö —Å–∫—Ä–∏–ø—Ç–∞ —Å–±–æ—Ä–∫–∏.

## –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Firebase messaging –≤ –≤–∞—à–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

–î–∞–ª–µ–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å –∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞—Å—à–∏—Ä—è–µ—Ç `FirebaseMessagingService`. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ SDK –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–æ–≥–æ, —á—Ç–æ –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —ç—Ç—É —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é.

> üëç
>
> –≠—Ç–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–µ –≤–∫–ª—é—á–µ–Ω–∞ –≤ SDK, —á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –µ–≥–æ –∫–∞–∫ –º–æ–∂–Ω–æ –º–µ–Ω—å—à–∏–º –∏ –∏–∑–±–µ–∂–∞—Ç—å –≤–∫–ª—é—á–µ–Ω–∏—è –±–∏–±–ª–∏–æ—Ç–µ–∫, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —è–≤–ª—è—é—Ç—Å—è —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –¥–ª—è –µ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏. –í—ã –º–æ–∂–µ—Ç–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω—ã–π –Ω–∏–∂–µ –ø—Ä–∏–º–µ—Ä –∫–æ–¥–∞ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –≤ —Å–≤–æ–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏.

1. –°–æ–∑–¥–∞–π—Ç–µ —Å–µ—Ä–≤–∏—Å:
   ```kotlin
    import android.app.NotificationManager  
    import android.content.Context  
    import ru.sendsay.sdk.Sendsay  
    import com.google.firebase.messaging.FirebaseMessagingService  
    import com.google.firebase.messaging.RemoteMessage

    class MyFirebaseMessagingService: FirebaseMessagingService() {

        private val notificationManager by lazy {
            getSystemService(Context.NOTIFICATION_SERVICE) as NotificationManager
        }

        override fun onMessageReceived(message: RemoteMessage) {
            super.onMessageReceived(message)
            if (!Sendsay.handleRemoteMessage(applicationContext, message.data, notificationManager)) {
                // push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç –¥—Ä—É–≥–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
            }
        }

        override fun onNewToken(token: String) {
            super.onNewToken(token)
            Sendsay.handleNewToken(applicationContext, token)
        }
    }
   ```
2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ —Å–µ—Ä–≤–∏—Å –≤ `AndroidManifest.xml`:
   ```xml
    <service android:name="MyFirebaseMessagingService" android:exported="false" >  
        <intent-filter> 
            <action android:name="com.google.firebase.MESSAGING_EVENT" />  
        </intent-filter>
    </service>   
   ```

SDK –±—É–¥–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–æ–æ–±—â–µ–Ω–∏—è push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π, –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Å –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã Engagement. –¢–∞–∫–∂–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ `Sendsay.isSendsayPushNotification()`.

–ï—Å–ª–∏ –≤—ã –∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, SDK –¥–æ–ª–∂–µ–Ω –æ—Ç—Å–ª–µ–¥–∏—Ç—å push-—Ç–æ–∫–µ–Ω –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ Engagement. –ï—Å–ª–∏ –≤—ã –≤–∫–ª—é—á–∏–ª–∏ —Å–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫—É, –æ–Ω–∞ —Å–æ–æ–±—â–∏—Ç –≤–∞–º –æ–± —ç—Ç–æ–º. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ, –≤—ã –º–æ–∂–µ—Ç–µ –Ω–∞–π—Ç–∏ –∫–ª–∏–µ–Ω—Ç–∞ –≤ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ Engagement –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–≤–æ–π—Å—Ç–≤–æ –∫–ª–∏–µ–Ω—Ç–∞ `google_push_notification_id`.

Push-—Ç–æ–∫–µ–Ω –æ–±—ã—á–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –Ω–æ —É –Ω–µ–≥–æ –µ—Å—Ç—å —Å–≤–æ–π –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª. –í–∞—à–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è `FirebaseMessagingService` —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ç–æ–∫–µ–Ω —Å–æ–∑–¥–∞–Ω –∏–ª–∏ –µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–≤–æ–∏ –æ–∂–∏–¥–∞–Ω–∏—è –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º–∏ [—Ç—Ä–∏–≥–≥–µ—Ä–∞–º–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞](https://firebase.google.com/docs/cloud-messaging/android/client#sample-register)

> ‚ùóÔ∏è
>
> –ù–∞—á–∏–Ω–∞—è —Å Android 13 (—É—Ä–æ–≤–µ–Ω—å API 33), —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–æ –≤ –≤–∞—à–µ–º `AndroidManifest.xml` –∏ —Ç–∞–∫–∂–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –º–æ–≥–ª–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è. SDK –∑–∞–±–æ—Ç–∏—Ç—Å—è –æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è. –û–¥–Ω–∞–∫–æ –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –∑–∞–ø—Ä–æ—Å–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –≤—ã–∑–≤–∞–≤ `Sendsay.requestPushAuthorization(context)`. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —Ä–∞–∑–¥–µ–ª—É [–ó–∞–ø—Ä–æ—Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è](https://documentation.bloomreach.com/engagement/docs/android-sdk-push-notifications#request-notification-permission) –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π.
>
> –ï—Å–ª–∏ –≤–∞—à –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤—ã–π –ø–æ—Ç–æ–∫ —Å—Ç—Ä–æ–≥–æ —Ç—Ä–µ–±—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –æ–±—ã—á–Ω—ã—Ö push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π, –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ SDK –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö push-—Ç–æ–∫–µ–Ω–æ–≤, —É—Å—Ç–∞–Ω–æ–≤–∏–≤ [requirePushAuthorization](https://documentation.bloomreach.com/engagement/docs/android-sdk-configuration) –≤ `true`. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —Ä–∞–∑–¥–µ–ª—É [–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è](https://documentation.bloomreach.com/engagement/docs/android-sdk-push-notifications#require-notification-permission) –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π.

> ‚ùóÔ∏è
>
> –ï—Å–ª–∏ –≤—ã –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç–µ –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç Firebase –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø—Ä–æ–µ–∫—Ç –∏–ª–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –º–µ–Ω—è–µ—Ç–µ –ø—Ä–æ–µ–∫—Ç Firebase, –≤—ã –º–æ–∂–µ—Ç–µ —Å—Ç–æ–ª–∫–Ω—É—Ç—å—Å—è —Å –ø—Ä–æ–±–ª–µ–º–æ–π, —á—Ç–æ –≤–∞—à 'FirebaseMessagingService' –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
>
> –ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Å–≤–µ–∂–∏–π FCM —Ç–æ–∫–µ–Ω, —Ä–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–∞ —Ç–æ–∫–µ–Ω–∞ –≤—Ä—É—á–Ω—É—é –∫–∞–∫ –º–æ–∂–Ω–æ —Å–∫–æ—Ä–µ–µ –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Firebase:
>
> ```kotlin
> import android.app.Application
> import ru.sendsay.sdk.Sendsay
> import com.google.firebase.installations.FirebaseMessaging
> 
> class SendsayApp : Application() {
>     override fun onCreate() {
>        super.onCreate()
>        FirebaseMessaging.getInstance().token.addOnSuccessListener {
>            Sendsay.handleNewToken(applicationContext, it)
>        }
>     }
> }
> ```

> ‚ùóÔ∏è
>
> –ú–µ—Ç–æ–¥—ã `Sendsay.handleNewToken` –∏ `Sendsay.handleRemoteMessage` –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ SDK, –µ—Å–ª–∏ –ø—Ä–µ–¥—ã–¥—É—â–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±—ã–ª–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞. –í —Ç–∞–∫–æ–º —Å–ª—É—á–∞–µ –∫–∞–∂–¥—ã–π –º–µ—Ç–æ–¥ –±—É–¥–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏—è —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π –ø–æ—Å–ª–µ–¥–Ω–µ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏. –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ SDK –≤ `Application::onCreate`, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Å–≤–µ–∂–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –≤ —Å–ª—É—á–∞–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ Firebase Cloud Messaging –≤ Engagement

–ù–∞–∫–æ–Ω–µ—Ü, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é Firebase Cloud Messaging –≤ Engagement, —á—Ç–æ–±—ã –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –º–æ–≥–ª–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç—Ä–µ–±—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞ –∏–∑ Service Account, –∫–æ—Ç–æ—Ä—ã–π –≤—ã —Å–æ–∑–¥–∞–µ—Ç–µ –≤ Google Cloud, –∞ –∑–∞—Ç–µ–º –∫–æ–ø–∏—Ä—É–µ—Ç–µ —ç—Ç–æ—Ç –∫–ª—é—á –≤ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ Bloomreach Engagement.

–°–ª–µ–¥—É–π—Ç–µ —à–∞–≥–∞–º –Ω–∏–∂–µ:

1. **–°–æ–∑–¥–∞–π—Ç–µ service account.** –ß—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π service account –≤ Google Cloud, –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ `Service Accounts` –∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ–π –ø—Ä–æ–µ–∫—Ç. –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ Service Accounts –≤—ã–±–µ—Ä–∏—Ç–µ `Create Service Account`. –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–æ–ª–∏ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞.

2. **–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –Ω–æ–≤—ã–π –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á**. –ù–∞–π–¥–∏—Ç–µ FCM service account, –∫–æ—Ç–æ—Ä—ã–π –≤—ã —Å–æ–∑–¥–∞–ª–∏ –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–º —à–∞–≥–µ, –∑–∞—Ç–µ–º –≤—ã–±–µ—Ä–∏—Ç–µ `Actions` > `Manage Keys`. –í—ã–±–µ—Ä–∏—Ç–µ `Add Key` > `Create new key`. –°–∫–∞—á–∞–π—Ç–µ —Ñ–∞–π–ª –∫–ª—é—á–∞ JSON.

3. **–î–æ–±–∞–≤—å—Ç–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é Firebase Cloud Messaging** –≤ –≤–∞—à –ø—Ä–æ–µ–∫—Ç Engagement. –í Engagement –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ `Data & Assets` > `Integration`. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ `Add new integration` –∏ –≤—ã–±–µ—Ä–∏—Ç–µ `Firebase Cloud Messaging` –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —á–µ—Ä–µ–∑ —É–∑–µ–ª push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π. –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –µ—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ webhooks, –≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–±—Ä–∞—Ç—å `Firebase Service Account Authentication`.
![](https://raw.githubusercontent.com/exponea/exponea-android-sdk/main/Documentation/images/firebase-1.png)

4. **–í—Å—Ç–∞–≤—å—Ç–µ –∫–ª—é—á –∏–∑ —à–∞–≥–∞ 2** –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ Firebase Cloud Messaging –≤ –ø–æ–ª–µ `Service Account JSON Credentials`. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ `Save integration`.
![](https://raw.githubusercontent.com/exponea/exponea-android-sdk/main/Documentation/images/firebase-2.png)

5. **–í—ã–±–µ—Ä–∏—Ç–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é Firebase Cloud Messaging** –≤ `Project Settings` > `Channels` > `Push notifications` > `Firebase Cloud Messaging integration`. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ `Save changes`.

–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ Engagement —Ç–µ–ø–µ—Ä—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å–ø–æ—Å–æ–±–Ω–∞ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–∞ Android-—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —á–µ—Ä–µ–∑ —É–∑–µ–ª push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.

#### –ß–µ–∫-–ª–∏—Å—Ç

- [ ] –ï—Å–ª–∏ –≤—ã –∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, —Å–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å–ø–æ—Å–æ–±–Ω–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∏ –ø–æ–ª—É—á–∏—Ç—å –±–µ–∑–∑–≤—É—á–Ω–æ–µ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ.
  ![](https://raw.githubusercontent.com/exponea/exponea-android-sdk/main/Documentation/images/self-check.png)
- [ ] –¢–µ–ø–µ—Ä—å –≤—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–ø–æ—Å–æ–±–Ω—ã –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å –ø–æ–º–æ—â—å—é –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Engagement –∏ –ø–æ–ª—É—á–∞—Ç—å –∏—Ö –≤ –≤–∞—à–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —Ä–∞–∑–¥–µ–ª—É [–ú–æ–±–∏–ª—å–Ω—ã–µ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è](https://documentation.bloomreach.com/engagement/docs/mobile-push-notifications#creating-a-new-notification), —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å, –∫–∞–∫ —Å–æ–∑–¥–∞–≤–∞—Ç—å push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ Engagement.
- [ ] –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–µ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∏–∑ Engagement –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∏ –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –Ω–µ–≥–æ. –í–∞—à broadcast receiver –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤—ã–∑–≤–∞–Ω.

> üëç
>
> –°–µ—Ä–≤–∏—Å—É Engagement –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—é Firebase –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –º–∏–Ω—É—Ç–∞, —á—Ç–æ–±—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è. –ï—Å–ª–∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ —É–¥–∞–µ—Ç—Å—è, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ. –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ 2-3 –ø–æ–ø—ã—Ç–æ–∫, –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–∏—Ç–µ –≤–∞—à—É –Ω–∞—Å—Ç—Ä–æ–π–∫—É.

–¢–µ–ø–µ—Ä—å –≤—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–ø–æ—Å–æ–±–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è Engagement. –í—ã –º–æ–∂–µ—Ç–µ –æ—Ç–∫–ª—é—á–∏—Ç—å —Å–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫—É –∏–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –µ–µ –≤–∫–ª—é—á–µ–Ω–Ω–æ–π –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π —Å–±–æ—Ä–∫–∏.